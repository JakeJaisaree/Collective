openapi: 3.1.0
info:
  title: Experiential Network API
  version: 1.0.0
servers:
  - url: https://your-domain.com   # ← replace with your actual base URL

paths:
  /create_user_sheet:
    post:
      operationId: createUserSheet
      summary: Onboard a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                  description: Unique identifier for the user.
              required:
                - user_id
      responses:
        '200':
          description: Created

  /fetch_experiential_network:
    post:
      operationId: fetchExperientialNetwork
      summary: Fetch all nodes and connections
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sheet_id:
                  type: string
                  description: The Google Sheet ID.
              required:
                - sheet_id
      responses:
        '200':
          description: OK

  /upsert_node:
    post:
      operationId: upsertNode
      summary: Add or update a node
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sheet_id:
                  type: string
                node:
                  type: object
                  properties:
                    NodeID:
                      type: string
                    NodeType:
                      type: string
                      enum: [Object, Configuration]
                    Quality:
                      type: string
                      enum: [U, "▲"]
                    Energy:
                      type: integer
                      minimum: 1
                      maximum: 5
                    Description:
                      type: string
                  required:
                    - NodeType
                    - Quality
                    - Energy
                    - Description
              required:
                - sheet_id
                - node
      responses:
        '200':
          description: OK

  /upsert_connection:
    post:
      operationId: upsertConnection
      summary: Add or update a connection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sheet_id:
                  type: string
                conn:
                  type: object
                  properties:
                    SourceNodeID:
                      type: string
                    TargetNodeID:
                      type: string
                    Action:
                      type: string
                      enum: ["+", "-"]
                    Weight:
                      type: number
                    Context:
                      type: string
                  required:
                    - SourceNodeID
                    - TargetNodeID
                    - Action
                    - Weight
              required:
                - sheet_id
                - conn
      responses:
        '200':
          description: OK

  /check_and_join:
    post:
      operationId: checkAndJoin
      summary: Check threshold & join collective
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                sheet_id:
                  type: string
                threshold:
                  type: number
                  default: 0.7
              required:
                - user_id
                - sheet_id
      responses:
        '200':
          description: OK
